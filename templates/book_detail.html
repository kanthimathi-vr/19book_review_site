{% extends 'base.html' %}

{% block content %}
<h2>{{ book.title }} by {{ book.author }}</h2>
<img src="{{ url_for('static', filename=book.cover) }}" alt="{{ book.title }}" class="cover-large">

<section class="review-form">
    <h3>Submit a Review</h3>
    <form method="POST" action="{{ url_for('book_detail', book_id=book.id) }}">
        <label>Username:<br>
            <input type="text" name="username" required>
        </label><br><br>

        <label>Rating:
            <select name="rating" required>
                {% for r in range(1,6) %}
                <option value="{{ r }}">{{ r }}</option>
                {% endfor %}
            </select>
        </label><br><br>

        <label>Review:<br>
            <textarea name="review" rows="4" cols="40" required></textarea>
        </label><br><br>

        <button type="submit">Submit Review</button>
    </form>
</section>

<hr>

<section class="reviews">
    <h3>Reviews {% if filter_rating %} (Rating: {{ filter_rating }}) {% endif %}</h3>

    <form method="GET" action="{{ url_for('book_detail', book_id=book.id) }}">
        <label>Filter by rating:
            <select name="rating" onchange="this.form.submit()">
                <option value="">All</option>
                {% for r in range(1,6) %}
                <option value="{{ r }}" {% if filter_rating == r %}selected{% endif %}>{{ r }}</option>
                {% endfor %}
            </select>
        </label>
    </form>

    {% if reviews %}
        <ul class="review-list">
            {% for rev in reviews %}
            <li>
                <strong>{{ rev.username }}</strong> rated <strong>{{ rev.rating }}/5</strong><br>
                <p>{{ rev.text }}</p>
            </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No reviews yet.</p>
    {% endif %}
</section>
{% endblock %}
